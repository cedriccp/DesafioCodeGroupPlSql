//Criar uma function PL/SQL que calcule o total de um pedido (informando o ID do pedido).
CREATE OR REPLACE FUNCTION FN_TOTAL_PEDIDO
       ( PEDIDOS.PEDIDO_ID NUMBER  PEDIDOS.PRODUTO_ID NUMBER)
       RETURN BOLEAN
     AS
       V_RETORNAVALOR BOLEAN;
     V_PRODUTO NUMBER;
     V_PEDIDO NUMBER;
     V_TOTALPEDIDO NUMBER(15,2)
BEGIN
    V_PEDIDO :=PEDIDOS.PEDIDO_ID;
    V_PRODUTO := PEDIDOS.PRODUTO_ID
END;

BEGIN
       SELECT SUM(PROD.PRECO * ITENS.QUANTIDADE) 
INTO V_TOTALPEDIDO
         FROM PEDIDOS PED inner Join PRODUTOS PROD ON  PROD.PRODUTO_ID = PED.PRODUTO_ID
    Inner Join ITENS_PEDIDOS ITENS ON
PED.PRODUTO_ID = ITENS.PRODUTO_ID AND 
ITENS.PEDIDO_ID = PED.PEDIDO_ID
        WHERE V_PRODUTO = ITENS.PRODUTO_ID AND V_PEDIDO = ITENS.PEDIDO_ID
GROUP BY ITENS.PEDIDO_ID, ITENS_PRODUTO_ID;
END;

BEGIN
IF (V_TOTALPEDIDO) > 0
THEN 
UPDATE PEDIDO
SET TOTAL_PEDIDO = V_TOTALPEDIDO
WHERE PEDIDO_ID = V_PEDIDO AND
PRODUTO_ID = V_PRODUTO;
V_RETORNAVALOR := TRUE; 
ELSE
V_RETORNAVALOR := FALSE;
END;

BEGIN
IF V_RETORNAVALOR = TRUE
COMMIT
DBMS_
OUTPUT.PUT_LINE('Total do pedido: ' || V_PEDIDO || ' Atualizado.');
ELSE 
ROLLBACK;
V_RETORNAVALOR := FALSE; 
END IF;   
END;

BEGIN
RETURN V_RETORNAVALOR;
END;
END FN_TOTAL_PEDIDO;


